{"version":3,"file":"network-connector.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\nimport { AbstractConnector } from '@web3-react/abstract-connector'\nimport Web3ProviderEngine from 'web3-provider-engine'\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\nimport invariant from 'tiny-invariant'\n\ninterface NetworkConnectorArguments {\n  urls: { [chainId: number]: string }\n  defaultChainId?: number\n  pollingInterval?: number\n  requestTimeoutMs?: number\n}\n\nexport class NetworkConnector extends AbstractConnector {\n  private readonly providers: { [chainId: number]: any }\n  private currentChainId: number\n  private readonly pollingInterval?: number\n  private readonly requestTimeoutMs?: number\n  private active: boolean\n\n  constructor({ urls, defaultChainId, pollingInterval, requestTimeoutMs }: NetworkConnectorArguments) {\n    invariant(defaultChainId || Object.keys(urls).length === 1, 'defaultChainId is a required argument with >1 url')\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) })\n\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0])\n    this.pollingInterval = pollingInterval\n    this.requestTimeoutMs = requestTimeoutMs\n    this.providers = Object.keys(urls).reduce((accumulator, chainId) => {\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\n      engine.addProvider(new CacheSubprovider())\n      engine.addProvider(new RPCSubprovider(urls[Number(chainId)], this.requestTimeoutMs))\n      return Object.assign(accumulator, { [Number(chainId)]: engine })\n    }, {})\n    this.active = false\n  }\n\n  public async activate(): Promise<ConnectorUpdate> {\n    this.providers[this.currentChainId].start()\n    this.active = true\n    return { provider: this.providers[this.currentChainId], chainId: this.currentChainId, account: null }\n  }\n\n  public async getProvider(): Promise<Web3ProviderEngine> {\n    return this.providers[this.currentChainId]\n  }\n\n  public async getChainId(): Promise<number> {\n    return this.currentChainId\n  }\n\n  public async getAccount(): Promise<null> {\n    return null\n  }\n\n  public deactivate() {\n    this.providers[this.currentChainId].stop()\n    this.active = false\n  }\n\n  public changeChainId(chainId: number) {\n    invariant(Object.keys(this.providers).includes(chainId.toString()), `No url found for chainId ${chainId}`)\n    if (this.active) {\n      this.providers[this.currentChainId].stop()\n      this.currentChainId = chainId\n      this.providers[this.currentChainId].start()\n      this.emitUpdate({ provider: this.providers[this.currentChainId], chainId })\n    } else {\n      this.currentChainId = chainId\n    }\n  }\n}\n"],"names":["NetworkConnector","urls","defaultChainId","pollingInterval","requestTimeoutMs","Object","keys","length","invariant","supportedChainIds","map","k","Number","currentChainId","providers","reduce","accumulator","chainId","engine","Web3ProviderEngine","addProvider","CacheSubprovider","RPCSubprovider","assign","active","activate","start","provider","account","getProvider","getChainId","getAccount","deactivate","stop","changeChainId","includes","toString","emitUpdate","AbstractConnector"],"mappings":"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"}